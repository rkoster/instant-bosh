---
# Configure LXD CPI with runtime variables
# This ops-file is applied at runtime by Incus users to set actual LXD server config
# and switch the director to use lxd_cpi instead of docker_cpi
#
# Required variables:
#   lxd_server_type: Server type (lxd or incus)
#   lxd_server_url: LXD/Incus server URL (e.g., https://10.246.0.1:8443)
#   lxd_client_cert: Client TLS certificate
#   lxd_client_key: Client TLS key
#   lxd_project_name: LXD/Incus project name
#   lxd_profile_name: LXD/Incus profile name
#   lxd_network_name: LXD/Incus network name
#   lxd_storage_pool_name: LXD/Incus storage pool name
#
# Note: insecure_skip_verify is hardcoded to true since instant-bosh uses self-signed certs

# Switch director to use LXD CPI
- type: replace
  path: /instance_groups/name=bosh/properties/director/cpi_job
  value: lxd_cpi

# Configure LXD CPI server settings
- type: replace
  path: /instance_groups/name=bosh/jobs/name=lxd_cpi/properties/lxd_cpi/server
  value:
    type: ((lxd_server_type))
    url: ((lxd_server_url))
    insecure_skip_verify: true
    tls_client_cert: ((lxd_client_cert))
    tls_client_key: ((lxd_client_key))
    project_name: ((lxd_project_name))
    profile_name: ((lxd_profile_name))
    network_name: ((lxd_network_name))
    storage_pool_name: ((lxd_storage_pool_name))
